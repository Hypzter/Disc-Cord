@page
@model Disc_Cord.Pages.MessagesModel
@inject SignInManager<Models.ApplicationUser> SignInManager
@inject UserManager<Models.ApplicationUser> UserManager
@{
	var user = await UserManager.GetUserAsync(User);
	var unRead = Model.Messages.Where(x => x.IsRead == false).ToList();
}
@if (SignInManager.IsSignedIn(User))
{
	@if (Model.Messages != null)
	{

		<a class="btn btn-success mb-2" asp-route-userid="@user.Id" asp-page="./Inbox">Inbox @Model.Messages.Count <span class="fw-bold">(@unRead.Count)</span></a>

	}
	<hr />
	<h3>Skicka nytt meddelande</h3>

	<form method="post">
		<input asp-for="NewMessage.SenderId" type="hidden" value="@user.Id" />		
		<input asp-for="NewMessage.IsRead" type="hidden" value="false" />
		<input asp-for="NewMessage.Headline" class="form-control mb-1" placeholder="Rubrik" />
		<textarea asp-for="NewMessage.Text" class="form-control" cols="40" rows="5" placeholder="Skriv ditt meddelande"></textarea>
		<label for="NewMessage_ReceiverId">Mottagare: </label>
		<select class="mt-2 mb-2" asp-for="NewMessage.ReceiverId" asp-items="@(new SelectList(Model.Users, "Id", "Alias"))"></select>
		<br>
		<input type="submit" name="addTask" value="Skicka" class="btn btn-primary" />
	</form>
}
