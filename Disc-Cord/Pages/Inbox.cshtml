@page
@using Extensions
@model Disc_Cord.Pages.InboxModel
@inject SignInManager<Models.ApplicationUser> SignInManager
@inject UserManager<Models.ApplicationUser> UserManager
@{
	var user = await UserManager.GetUserAsync(User);
	string[] headlines = new string[] { "Meddelande", "Skickat av", "Skickat", "" };

}
<a asp-page="./Messages" class="btn btn-secondary mb-2">Tillbaka</a>

@if (SignInManager.IsSignedIn(User))
{

	@if (Model.Messages != null)
	{

		<div class="card border-2">
			<div class="card-header bg-warning text-black fs-4 fw-bold">
				Inbox
			</div>
			<div class="m-0 p-0 text-start">
				<table class="table table-striped m-0 p-0">
					<thead class="bg-black text-white">
						<tr>

							@foreach (var h in headlines)
							{
								<th>@h</th>
							}
						</tr>
					</thead>
					<tbody>
						@foreach (var message in Model.Messages)
						{
							<tr>
								<td>
									@if (message.IsRead)
									{
										<a class="text-black col-10 text-decoration-none" asp-route-messageid="@message.Id" asp-page="./InboxMessage">@message.Text.LimitLength(30)</a>

									}
									else
									{
										<a class="text-black col-10 text-decoration-none fw-bold" asp-route-messageid="@message.Id" asp-page="./InboxMessage">@message.Text.LimitLength(30)</a>

									}
								</td>
								@foreach (var u in Model.Users)
								{
									@if (@u.Id == message.SenderId && @u.Alias != null)
									{

										<td>

											<p class="text-black text-decoration-none pb-0 mb-0"><a asp-page="./UserPage" asp-route-userid="@u.Id">@u.Alias</a></p>
										</td>
										<td>
											<p class="fw-lighter">@message.Timestamp.ToString("dd/MM/yy HH:mm")</p>
										</td>
									}
								}
								<td>
									<a type="submit" class="btn btn-danger" asp-route-deletemessageid="@message.Id">Ta bort</a>

								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	}
}
